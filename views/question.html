<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>StabOverflow</title>

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

		<script>
			// script to apply upvoting changes in UI
			function upvote(uid) {
				$.post('/upvote', { uid: uid })
					.done(function(data) {
						var $p = $('#' + uid);
						var n = parseInt($p.text(), 10) + data.delta;
						$p.text(n);
					});
			}
		</script>

		<!-- PageDown editor -->
		<link rel="stylesheet" type="text/css" href="../pagedown/pagedown.css" />
		<script type="text/javascript" src="../pagedown/Markdown.Converter.js"></script>
        <script type="text/javascript" src="../pagedown/Markdown.Sanitizer.js"></script>
        <script type="text/javascript" src="../pagedown/Markdown.Editor.js"></script>
	</head>
	<body>
		<!-- PUT NAVBAR HERE -->

		<div>
			<!-- question -->
			<div>
				<div>
					{{^noCategory}}
						<form name="getCategory" method="POST" action="/search">
							<input name="category" value="{{category_uid}}" hidden>
							<div onclick="document.getCategory.submit()">Category: {{category}}</div>
						</form>
					{{/noCategory}}
					<div>
						<span id="{{question_uid}}">{{upvotes}}</span> upvotes<br>
						<div onclick="upvote({{question_uid}});">Upvote</div>
					</div>
				</div>
				<h1>{{title}}</h1>
				<div>{{{body}}}</div>
				<div>asked {{creation_date}} by <a href="/users/{{owner_uid}}">{{owner_name}}</a></div>
				<div>
					{{#tags}}
						<span>{{tag}}</span>
					{{/tags}}
				</div>

				<!-- question comments -->
				<div>
					{{#comments}}
						<div>
							<div>{{{body}}}</div>
							- <a href="/users/{{owner_uid}}">{{owner_name}}</a> at {{creation_date}}
						</div>
					{{/comments}}
				</div>

				{{#loggedIn}}
					<!-- make question comment -->
					<form method="POST" action="/newComment">
						<input name="parent_question" value="{{question_uid}}" hidden>
						<input name="parent_uid" value="{{question_uid}}" hidden>
						<textarea name="body"></textarea>
						<button type="submit">Post Comment</button>
					</form>
				{{/loggedIn}}
			</div>

			<!-- answers -->
			<div>
				<h2>{{answer_count}} Answers</h2>
				{{#answers}}
					<div>
						<div><span id="{{answer_uid}}">{{upvotes}}</span> upvotes</div>
						<div onclick="upvote({{answer_uid}});">Upvote</div>
						<div>{{{body}}}</div>
						answered {{creation_date}} by <a href="/users/{{owner_uid}}">{{owner_name}}</a>

						<!-- answer comments -->
						<div>
							{{#answer_comments}}
								<div>
									<div>{{{body}}}</div>
									- <a href="/users/{{owner_uid}}">{{owner_name}}</a> at {{creation_date}}
								</div>
							{{/answer_comments}}
						</div>

						{{#loggedIn}}
							<!-- make answer comment -->
							<form method="POST" action="/newComment">
								<input name="parent_question" value="{{question_uid}}" hidden>
								<input name="parent_uid" value="{{answer_uid}}" hidden>
								<textarea name="body"></textarea>
								<button type="submit">Post Comment</button>
							</form>
						{{/loggedIn}}

					</div>
				{{/answers}}
			</div>

			{{#loggedIn}}
				<!-- write an answer form -->
				<h2>Your Answer</h2>
				<form method="POST" action="/newPost">
					<input hidden name="type" value="0">
					<input hidden name="parent_question" value="{{question_uid}}">
					<div class="wmd-panel">
						<div id="wmd-button-bar"></div>
						<textarea name="body" class="wmd-input" id="wmd-input"></textarea>
					</div>

					<div id="wmd-preview" class="wmd-panel wmd-preview"></div>
					<button type="submit">Post Your Answer</button>
				</form>

				<script type="text/javascript">
		            (function () {
		                var converter = Markdown.getSanitizingConverter();
		                var editor = new Markdown.Editor(converter);
		                editor.run();
		                console.log(editor);
		            })();
		        </script>
	        {{/loggedIn}}
		</div>

	</body>
</html>